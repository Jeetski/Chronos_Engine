Goals:
1. Give the Matrix panel (and future analytics) a fast, structured source of item/template metadata.
2. Preserve YAML as the source of truth while avoiding repetitive on-demand parsing in dashboard endpoints.
3. Surface dynamic pickers (dimensions, metrics, filters, value orderings) that reflect user-defined properties and settings.

Motivation / Current Pain:
- Dashboard endpoints inspect YAML every request and only expose hard-coded fields, so custom properties and ordering rules (priority, status, tags) are invisible.
- The Matrix panel relies on freeform text inputs; discovering field names/values is clunky and prevents curated experiences.
- Settings already define ordering (e.g., priority ladders) but nothing surfaces those consistently.

Proposal Overview:
- Introduce a lightweight relational cache (SQLite) generated from existing YAML.
- Add a CLI command (placeholder name: `sequence`) that walks User/, Modules metadata, and settings to populate/update the DB.
- APIs (especially `/api/cockpit/matrix`) query SQLite for distinct dimensions, metrics, property lists, and ordered values.
- YAML remains canonical for edits; SQLite is read-only data for analytics/UI.

`sequence` Command Responsibilities:
1. Discover item/template metadata
   - Walk `User/<TypePlural>/` for items, capturing type, template, status, custom props (flatten nested dicts to dotted keys).
   - Inspect `Utilities/` metadata (e.g., module-registered item types, templates) to know available dimensions beyond what exists in current YAML.
2. Load settings for order/value hints
   - Parse `User/Settings/*` (priority ladders, status configs, tag catalogs, property enums) and map them into ordering tables.
   - Record template-specific metadata (routine/day/week definitions, allowed children) for future panels.
3. Populate SQLite tables
   - `items(id, type, name, path, template_type, status, priority, points, duration_minutes, created_at, updated_at, raw json)`
   - `item_properties(item_id, key, value)` with indexes for key/value queries.
   - `template_types(name, category, description)`
   - `property_catalog(key, value, display_order, source)` capturing ordered lists from settings.
   - `metrics(id, label, expression, unit)` to define reusable aggregations (count, sum(duration), sum(points)).
   - `sync_status(last_run, version, source_hash)` to detect staleness.
4. Persist DB (e.g., `Temp/matrix_cache.db`) atomically to avoid partial writes.
5. Optional: register a watcher so key CLI commands (`new`, `set`, `delete`, `today reschedule`) trigger an incremental refresh.

Dashboard / API Changes:
- `/api/cockpit/matrix?meta=true` queries `property_catalog` + distinct keys in `item_properties` to build the dimension/filter pickers dynamically.
- `/api/cockpit/matrix` runs SQL aggregations instead of scanning YAML, supporting ordered columns/rows via `display_order`.
- Future widgets (e.g., Goal tracker) can reuse the same DB for fast filtering/search.

Benefits:
- Matrix panel can offer categorized pickers, curated presets, and drilldowns (SQL queries returning item lists per cell).
- Users see their custom metadata immediately without editing JS.
- Settings-defined ordering is respected everywhere.

Open Questions / Next Steps:
- Final name for the command (sequence? sync? hydrate?).
- Should we embed DB in `.venv`/AppData for persistence, or keep it alongside `Temp/` with version hashing?
- Incremental vs full rebuild: need heuristics to avoid reprocessing thousands of files after every minor edit.
- Security: confirm dashboard server only exposes aggregated data unless drilldown is explicitly requested.
- How to handle YAML schema changes (new properties) without DB migrations—likely keep schema generic (key/value pairs) and bump DB version when needed.

Visualizer Panel Concept:
- Add a new Cockpit panel (“Visualizer”) that consumes saved Matrix presets or ad-hoc queries and renders charts (bar/column, stacked, line, donut/pie, radar, heatmap).
- Pull datasets directly from the SQLite cache (shared with Matrix) so visual widgets can pivot on the same groupings/metrics without re-querying YAML.
- Provide preset library (e.g., Status vs Priority bar chart, Points by Category donut, Duration over Week line) plus a “build your own” flow: pick an existing Matrix preset, choose chart type, tweak color palettes, save as visualization preset.
- Support drill-through: clicking a chart slice opens the underlying Matrix cell items or launches a detail panel.
- Goal: make cockpit analytics navigable—Matrix for tables, Visualizer for trend/summary views—with both powered by the same relational cache to keep data in sync.
